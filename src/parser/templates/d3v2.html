{% macro richlink(item) %}
    {% if item.type == 'rich-link' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            <div class="content_image">
                <img src="{{ item.image }}" alt="{{ item.title }}">
            </div>
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta ">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.summary }}</div>
                </div>
            </a>
        </div>
    {% elif item.type == 'poor-link' %}
        <div class="content_box simple grid-item" data-item-type="{{ item.type }}">
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_url">{{ item.url|domain }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro video(item) %}
    {% if item.type == 'youtube' or item.type == 'vimeo' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            {{ item.html|safe }}
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.description|truncate }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro embed(item) %}
    {% if item.type == 'tweet' or item.type == 'spotify' %}
        <div class="content_box simple_dark embed grid-item" data-item-type="{{ item.type }}">
            {{ item.html|safe }}
        </div>
    {% endif %}
{% endmacro %}

{% macro xkcd(item) %}
    {% if item.type == 'xkcd' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            <div class="content_image">
                <img src="{{ item.img }}" alt="{{ item.title }}">
            </div>
            <a target="_blank" href="{{ item.link }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta ">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.explain }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro process(item) %}
    {{ richlink(item) }}
    {{ video(item) }}
    {{ embed(item) }}
    {{ xkcd(item) }}
{% endmacro %}

<!DOCTYPE html>
<html lang="en" class="export">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <title>D3 Weekly Digest</title>

        <link rel="stylesheet" href="style.css" media="screen">

        <!-- Google Fonts -->
        <link href='https://fonts.googleapis.com/css?family=PT+Serif+Caption:400,400italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,100,100italic,300,300italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

        <!-- jQuery + Isotope -->
        <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
    </head>
    <body class="page">
        <div id="page_cover">
            <div class="cover_pattern"></div>
            <header>
                <div class="d3_logo"></div>
                <h1 class="cover_title">Weekly Digest</h1>
                <div class="cover_separator">#</div>
                <div class="cover_description">what we are saying</div>
            </header>
        </div>

        <div class="pattern"></div>

        <div id="page_content">
            <nav class="content_top_menu">
                <a class="menu-item videos" href="#" title="Vídeos" alt="Vídeos">Videos</a>
                <a class="menu-item audios" href="#" title="Audios &amp; Musics" alt="Audios &amp; Musics">Audios &amp; Musics</a>
                <a class="menu-item contact" href="#" title="Contact us" alt="Contact us">Contact us</a>
                <a href="#" title="D3 Weekly Digest on GitHub" alt="D3 Weekly Digest on GitHub">
                    <div class="menu-item github">D3 Weekly Digest on GitHub</div>
                </a>
            </nav>

            <div id="content_wrapper" class="grid">
                <div class="content_box date_dark grid-item">
                    <h2 class="content_tittle">{{ extra.since|weekOfMonth }} Week</h2>
                    <div class="content_description">{{ extra.since|monthName }} {{ extra.since|yearOfDate }}</div>
                </div>

                <div class="who_contributed grid-item grid-sizer">
                    <h3 class="box_title">Who contributed</h3>
                    <ul class="contributors">
                        {% for user in users %}
                        <li class="contributor">
                            <img src="{{ user.image }}" alt="{{ user.real_name }}">
                            <div class="contributer_meta">
                                <h4 class="name">{{ user.real_name }}</h4>
                                <div class="posts_count">
                                    {{ itemsForUser[user.username]|length }} post{% if itemsForUser[user.username]|length > 1 %}s{% endif %}
                                </div>
                                <ul class="reactions">
                                    {% for emoji in user.emojis %}
                                        <li class="reaction">
                                            {{ emoji|emoji }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                {{ process(featuredItem) }}
                {% for item in items %}
                    {{ process(item) }}
                {% endfor %}
            </div>
        </div>
        <footer></footer>
        <script type="text/javascript" src="application.js"></script>
    </body>
</html>
