{% macro reactions(item) %}
<div class="content_reactions">
    <div class="reactions_title"><strong>D3</strong>reactions</div>
    <ul class="reactions">
        {% for reaction in item.reactions %}
        <li class="reaction">
            {{ reaction.name|emoji }}
        </li>
        {% endfor %}
    </ul>
</div>
{% endmacro %}

{% macro richlink(item) %}
    {% if item.type == 'rich-link' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            {{ reactions(item) }}
            <div class="content_image">
                <img src="{{ item.image }}" alt="{{ item.title }}">
            </div>
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta ">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.summary }}</div>
                </div>
            </a>
        </div>
    {% elif item.type == 'poor-link' %}
        <div class="content_box simple grid-item" data-item-type="{{ item.type }}">
            {{ reactions(item) }}
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_url">{{ item.url|domain }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro video(item) %}
    {% if item.type == 'youtube' or item.type == 'vimeo' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            {{ reactions(item) }}
            {{ item.html|safe }}
            <a target="_blank" href="{{ item.url }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.description|truncate }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro embed(item) %}
    {% if item.type == 'tweet' or item.type == 'spotify' %}
        <div class="content_box simple_dark embed grid-item" data-item-type="{{ item.type }}">
            {{ reactions(item) }}
            {{ item.html|safe }}
        </div>
    {% endif %}
{% endmacro %}

{% macro xkcd(item) %}
    {% if item.type == 'xkcd' %}
        <div class="content_box grid-item" data-item-type="{{ item.type }}">
            {{ reactions(item) }}
            <div class="content_image">
                <img src="{{ item.img }}" alt="{{ item.title }}">
            </div>
            <a target="_blank" href="{{ item.link }}" alt="{{ item.title }}" title="{{ item.title }}">
                <div class="content_meta ">
                    <h2 class="content_tittle">{{ item.title }}</h2>
                    <div class="content_description">{{ item.explain }}</div>
                </div>
            </a>
        </div>
    {% endif %}
{% endmacro %}

{% macro process(item) %}
    {{ richlink(item) }}
    {{ video(item) }}
    {{ embed(item) }}
    {{ xkcd(item) }}
{% endmacro %}

<!DOCTYPE html>
<html lang="en" class="export">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <title>D3 Weekly Digest</title>

        <link rel="stylesheet" href="style.css" media="screen">

        <!-- Google Fonts -->
        <link href='https://fonts.googleapis.com/css?family=PT+Serif+Caption:400,400italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,100,100italic,300,300italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>

        <!-- jQuery + Isotope -->
        <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
    </head>
    <body class="page">
        <div id="page_cover">
            <div class="cover_pattern"></div>
            <header>
                <div class="d3_logo"></div>
                <h1 class="cover_title">Weekly Digest</h1>
                <div class="cover_separator">#</div>
                <div class="cover_description">what we are saying</div>
            </header>
        </div>

        <div class="pattern"></div>

        <div id="page_content">
            <div id="content_wrapper" class="grid">
                <div class="content_box date_dark grid-item">
                    <h2 class="content_tittle">{{ extra.since|weekOfMonth }} Week</h2>
                    <div class="content_description">{{ extra.since|monthName }} {{ extra.since|yearOfDate }}</div>
                </div>

                {{ process(featuredItem) }}
                {% for item in items %}
                    {{ process(item) }}
                {% endfor %}
            </div>
        </div>
        <footer>
            <nav>
                <a href="http://d3.do" title="D3.do">D3.do</a>
                <a href="#" title="D3 Lab">D3 Lab</a>
                <a href="#" title="Contact us">Contact us</a>
                <a href="https://github.com/d3estudio/weekly-digest" title="Fork us on GitHub" target="_blank">Fork us on GitHub</a>
            </nav>
        </footer>
        <script type="text/javascript" src="application.js"></script>
    </body>
</html>
